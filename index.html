<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詞魂 | 全能雙語對照</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; overflow-x: hidden; }
        .serif { font-family: 'Noto Serif TC', serif; }
        .lyric-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(20px); }
        .primary-text { color: #fde68a; font-style: italic; font-size: 1.4em; line-height: 1.4; margin-top: 2rem; }
        .secondary-text { color: rgba(255,255,255,0.5); font-size: 0.9em; margin-top: 0.5rem; letter-spacing: 0.1em; }
        select option { background-color: #1a1a1a; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-xl mx-auto">
        <header class="text-center py-8">
            <h1 class="serif text-3xl font-bold tracking-[0.5em] text-amber-50">詞魂</h1>
            <p class="text-[9px] text-amber-200/40 mt-2 tracking-[0.2em] uppercase font-light">Universal Bilingual Translator</p>
        </header>

        <div class="lyric-card p-6 md:p-8 rounded-3xl mb-8">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="text-[9px] text-amber-200/50 uppercase tracking-widest block mb-2">引擎模式</label>
                    <select id="engine-mode" class="w-full bg-white/10 p-3 rounded-xl text-xs text-white outline-none border-none">
                        <option value="gemini">AI 靈魂模式 (需 Key)</option>
                        <option value="backup">備用穩定模式 (免 Key)</option>
                    </select>
                </div>
                <div>
                    <label class="text-[9px] text-amber-200/50 uppercase tracking-widest block mb-2">翻譯至 (Target)</label>
                    <select id="target-lang" class="w-full bg-white/10 p-3 rounded-xl text-xs text-white outline-none border-none">
                        <option value="Traditional Chinese">繁體中文</option>
                        <option value="English">Poetic English</option>
                        <option value="Japanese">日本語</option>
                        <option value="Korean">한국어</option>
                    </select>
                </div>
            </div>

            <div class="mb-6">
                <input type="password" id="api-key" placeholder="在此輸入 Gemini API Key..." class="w-full bg-white/5 border-none p-4 rounded-xl text-xs text-white outline-none focus:ring-1 focus:ring-amber-200/30">
            </div>

            <textarea id="input-text" rows="5" placeholder="輸入任何語言的歌詞原文..." 
                      class="w-full bg-transparent text-lg text-white/90 outline-none border-none resize-none mb-6"></textarea>

            <button onclick="handleTranslate()" id="btn" class="w-full bg-amber-50 text-black py-4 rounded-full font-bold tracking-widest hover:bg-white transition-all active:scale-95 shadow-2xl">
                執行全能對照翻譯
            </button>
        </div>

        <div id="result-box" class="hidden animate-in fade-in duration-1000 mb-20 text-center">
            <div class="lyric-card p-10 md:p-14 rounded-[2.5rem] border-amber-200/10">
                <div id="out-content" class="serif"></div>
                <div class="mt-12 h-[1px] w-12 bg-amber-200/10 mx-auto"></div>
            </div>
        </div>
    </div>

    <script>
        async function handleTranslate() {
            const mode = document.getElementById('engine-mode').value;
            const target = document.getElementById('target-lang').value;
            const key = document.getElementById('api-key').value.trim();
            const text = document.getElementById('input-text').value;
            const btn = document.getElementById('btn');
            const out = document.getElementById('out-content');

            if (!text) return alert('請輸入歌詞');
            
            btn.innerText = '正在感悟語境...';
            btn.disabled = true;

            try {
                if (mode === 'gemini') {
                    if (!key) throw new Error('AI 模式需要 API Key');
                    // 修正後的 API v1beta 路徑
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
                    const prompt = `你是一位精通多國語言的歌詞翻譯大師。
                    請將以下歌詞翻譯成${target}。
                    要求：
                    1. 保持電影感與詩意。
                    2. 輸出格式必須是：一行目標語言翻譯，緊跟著一行原文。
                    3. 不要任何額外解釋。
                    內容：\n${text}`;

                    const res = await fetch(url, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({contents: [{parts: [{text: prompt}]}]})
                    });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.error.message);
                    renderResult(data.candidates[0].content.parts[0].text);
                } else {
                    // 備用模式：自動識別對應的語言代碼
                    let langCode = 'zh-TW';
                    if(target === 'English') langCode = 'en';
                    if(target === 'Japanese') langCode = 'ja';
                    if(target === 'Korean') langCode = 'ko';

                    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${langCode}&dt=t&q=${encodeURIComponent(text)}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    let html = "";
                    data[0].forEach(item => {
                        if (item[0]) html += `<div class="primary-text">${item[0]}</div><div class="secondary-text">${item[1]}</div>`;
                    });
                    document.getElementById('result-box').classList.remove('hidden');
                    out.innerHTML = html;
                }
            } catch (e) {
                alert('失敗原因：' + e.message + '\n\n提示：請檢查 API Key 或切換備用模式。');
            } finally {
                btn.innerText = '執行全能對照翻譯';
                btn.disabled = false;
            }
        }

        function renderResult(fullText) {
            const lines = fullText.split('\n').filter(l => l.trim() !== "");
            let html = "";
            // AI 模式下，假設它是兩兩成對輸出
            for (let i = 0; i < lines.length; i++) {
                if (i % 2 === 0) {
                    html += `<div class="primary-text">${lines[i]}</div>`;
                } else {
                    html += `<div class="secondary-text">${lines[i]}</div>`;
                }
            }
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('out-content').innerHTML = html;
            window.scrollTo({ top: document.getElementById('result-box').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>
</html>
