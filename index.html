<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詞魂 | 英中對照視覺版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; }
        .serif { font-family: 'Noto Serif TC', serif; }
        .lyric-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(20px); }
        .highlight-text { color: #fde68a; line-height: 1.6; letter-spacing: 0.05em; font-style: italic; font-size: 1.2em; }
        .chinese-text { color: rgba(255,255,255,0.5); font-size: 0.9em; margin-bottom: 1.5rem; letter-spacing: 0.1em; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-xl mx-auto">
        <header class="text-center py-10">
            <h1 class="serif text-3xl font-bold tracking-[0.5em] text-amber-50">詞魂</h1>
            <p class="text-[9px] text-amber-200/40 mt-4 tracking-[0.4em] uppercase">Bilingual Cinema Edition</p>
        </header>

        <div class="lyric-card p-8 rounded-2xl mb-8">
            <div class="mb-6">
                <label class="text-[10px] text-amber-200/50 uppercase tracking-widest block mb-2">API 金鑰 (Google AI Studio)</label>
                <input type="password" id="api-key" placeholder="貼上 AIza... 開頭的 Key" class="w-full bg-white/5 border-none p-4 rounded-xl text-xs text-white outline-none focus:ring-1 focus:ring-amber-200/50 transition-all">
            </div>

            <textarea id="input-text" rows="5" placeholder="在此輸入廣東歌歌詞..." 
                      class="w-full bg-transparent text-lg text-white/90 outline-none border-none resize-none mb-6"></textarea>

            <button onclick="startTranslate()" id="btn" class="w-full bg-amber-50 text-black py-4 rounded-full font-bold tracking-widest hover:bg-white transition-all shadow-xl active:scale-95">
                賦予靈魂 · 雙語轉譯
            </button>
        </div>

        <div id="result-box" class="hidden animate-in fade-in duration-1000 mb-20">
            <div class="lyric-card p-10 md:p-14 rounded-[2rem] text-center border-amber-200/10 shadow-2xl">
                <div id="out-content" class="serif"></div>
                <div class="mt-12 flex justify-center items-center gap-4">
                    <div class="h-[1px] w-12 bg-amber-200/10"></div>
                    <span class="serif text-[9px] text-amber-200/20 tracking-[0.4em] uppercase">Lyric Soul Vision</span>
                    <div class="h-[1px] w-12 bg-amber-200/10"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function startTranslate() {
            const key = document.getElementById('api-key').value.trim();
            const text = document.getElementById('input-text').value;
            const btn = document.getElementById('btn');
            const out = document.getElementById('out-content');

            if (!key) return alert('請先貼上 API Key');
            if (!text) return alert('請輸入歌詞');

            btn.innerText = '正在釀造意境...';
            btn.disabled = true;

            // 【修復路徑】針對 v1beta 嘅正確 API 格式
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;

            const prompt = `你是一位精通粵語的翻譯大師。請將這段歌詞翻譯成 Poetic English。
            要求：
            1. 風格參考王家衛電影。
            2. 輸出格式必須是：每一行英文下面緊跟著對應的繁體中文原意。
            3. 絕對不要有額外的解釋。
            內容：\n${text}`;

            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({contents: [{parts: [{text: prompt}]}]})
                });
                
                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(data.error ? data.error.message : '連線失敗');
                }

                const rawText = data.candidates[0].content.parts[0].text;
                renderDualLanguage(rawText);

            } catch (e) {
                alert('報錯資訊：' + e.message);
            } finally {
                btn.innerText = '賦予靈魂 · 雙語轉譯';
                btn.disabled = false;
            }
        }

        function renderDualLanguage(fullText) {
            const lines = fullText.split('\n').filter(l => l.trim() !== "");
            let html = "";
            
            lines.forEach(line => {
                // 判斷係咪中文字
                if (/[\u4e00-\u9fa5]/.test(line)) {
                    html += `<div class="chinese-text">${line}</div>`;
                } else {
                    html += `<div class="highlight-text">${line}</div>`;
                }
            });
            
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('out-content').innerHTML = html;
            window.scrollTo({ top: document.getElementById('result-box').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>
</html>
